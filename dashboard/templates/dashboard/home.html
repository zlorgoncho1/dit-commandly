{% extends 'base/base.html' %}
{% load static %}

{% block title %}{{ title }} - Commandly{% endblock %}

{% block content %}
<!-- Section de bienvenue -->
<div class="card mb-4" style="background: linear-gradient(135deg, var(--color-primary) 0%, #1E40AF 100%); color: white; border: none;">
    <div class="card-body">
        <div class="d-flex justify-content-between align-items-center">
            <div>
                <h1 class="h2 mb-2" style="color: white;">Bienvenue, {{ user.get_full_name|default:user.username }} !</h1>
                <p class="mb-0" style="opacity: 0.9;">Voici un aperçu de votre activité commerciale</p>
            </div>
            <div class="text-end">
                <p class="mb-0" style="opacity: 0.9;">{{ today|date:"l d F Y" }}</p>
                <small style="opacity: 0.7;">Dernière connexion : {{ user.last_login|date:"d/m/Y à H:i"|default:"Première connexion" }}</small>
            </div>
        </div>
    </div>
</div>

<!-- Statistiques en grille compacte -->
<div class="row g-3 mb-4">
    <div class="col-xl-3 col-lg-3 col-md-6 col-12">
        <div class="card" style="background: #2D6EEA; color: white; border: none; border-radius: 12px; height: 110px; box-shadow: 0px 1px 2px rgba(0,0,0,0.05);">
            <div class="card-body p-3 d-flex align-items-center justify-content-between">
                <div>
                    <div style="font-size: 1.5rem; font-weight: 600;">{{ stats.total_orders|default:0 }}</div>
                    <div style="font-size: 0.875rem; opacity: 0.9; font-weight: 500;">Commandes</div>
                    <small style="font-size: 0.75rem; opacity: 0.7;">{{ stats.pending_orders|default:0 }} en attente</small>
                </div>
                <div class="text-center">
                    <i class="bi bi-list-check" style="font-size: 1.5rem; opacity: 0.3;"></i>
                    <div class="mt-1"><a href="{% url 'orders:order_list' %}" class="text-white" style="font-size: 0.75rem; text-decoration: none; opacity: 0.9;">Voir</a></div>
                </div>
            </div>
        </div>
    </div>

    <div class="col-xl-3 col-lg-3 col-md-6 col-12">
        <div class="card" style="background: #16A34A; color: white; border: none; border-radius: 12px; height: 110px; box-shadow: 0px 1px 2px rgba(0,0,0,0.05);">
            <div class="card-body p-3 d-flex align-items-center justify-content-between">
                <div>
                    <div style="font-size: 1.5rem; font-weight: 600;">{{ stats.total_customers|default:0 }}</div>
                    <div style="font-size: 0.875rem; opacity: 0.9; font-weight: 500;">Clients</div>
                    <small style="font-size: 0.75rem; opacity: 0.7;">{{ stats.active_customers|default:0 }} actifs</small>
                </div>
                <div class="text-center">
                    <i class="bi bi-people" style="font-size: 1.5rem; opacity: 0.3;"></i>
                    <div class="mt-1"><a href="{% url 'customers:customer_list' %}" class="text-white" style="font-size: 0.75rem; text-decoration: none; opacity: 0.9;">Voir</a></div>
                </div>
            </div>
        </div>
    </div>

    <div class="col-xl-3 col-lg-3 col-md-6 col-12">
        <div class="card" style="background: #6366F1; color: white; border: none; border-radius: 12px; height: 110px; box-shadow: 0px 1px 2px rgba(0,0,0,0.05);">
            <div class="card-body p-3 d-flex align-items-center justify-content-between">
                <div>
                    <div style="font-size: 1.5rem; font-weight: 600;">{{ stats.total_products|default:0 }}</div>
                    <div style="font-size: 0.875rem; opacity: 0.9; font-weight: 500;">Produits</div>
                    <small style="font-size: 0.75rem; opacity: 0.7;">{{ stats.active_products|default:0 }} actifs</small>
                </div>
                <div class="text-center">
                    <i class="bi bi-box" style="font-size: 1.5rem; opacity: 0.3;"></i>
                    <div class="mt-1"><a href="{% url 'products:product_list' %}" class="text-white" style="font-size: 0.75rem; text-decoration: none; opacity: 0.9;">Voir</a></div>
                </div>
            </div>
        </div>
    </div>

    <div class="col-xl-3 col-lg-3 col-md-6 col-12">
        <div class="card" style="background: #F97316; color: white; border: none; border-radius: 12px; height: 110px; box-shadow: 0px 1px 2px rgba(0,0,0,0.05);">
            <div class="card-body p-3 d-flex align-items-center justify-content-between">
                <div>
                    <div style="font-size: 1.5rem; font-weight: 600;">{{ stats.total_invoices|default:0 }}</div>
                    <div style="font-size: 0.875rem; opacity: 0.9; font-weight: 500;">Factures</div>
                    <small style="font-size: 0.75rem; opacity: 0.7;">{{ stats.pending_invoices|default:0 }} en attente</small>
                </div>
                <div class="text-center">
                    <i class="bi bi-receipt" style="font-size: 1.5rem; opacity: 0.3;"></i>
                    <div class="mt-1"><a href="{% url 'invoices:invoice_list' %}" class="text-white" style="font-size: 0.75rem; text-decoration: none; opacity: 0.9;">Voir</a></div>
                </div>
            </div>
        </div>
    </div>

    <div class="col-xl-3 col-lg-3 col-md-6 col-12">
        <div class="card" style="background: #8B5CF6; color: white; border: none; border-radius: 12px; height: 110px; box-shadow: 0px 1px 2px rgba(0,0,0,0.05);">
            <div class="card-body p-3 d-flex align-items-center justify-content-between">
                <div>
                    <div style="font-size: 1.5rem; font-weight: 600;">{{ stats.total_payments|default:0 }}</div>
                    <div style="font-size: 0.875rem; opacity: 0.9; font-weight: 500;">Paiements</div>
                    <small style="font-size: 0.75rem; opacity: 0.7;">{{ stats.payments_amount|default:0|floatformat:0 }} FCFA</small>
                </div>
                <div class="text-center">
                    <i class="bi bi-credit-card" style="font-size: 1.5rem; opacity: 0.3;"></i>
                    <div class="mt-1"><a href="{% url 'payments:payment_list' %}" class="text-white" style="font-size: 0.75rem; text-decoration: none; opacity: 0.9;">Voir</a></div>
                </div>
            </div>
        </div>
    </div>

    <div class="col-xl-3 col-lg-3 col-md-6 col-12">
        <div class="card" style="background: #DC2626; color: white; border: none; border-radius: 12px; height: 110px; box-shadow: 0px 1px 2px rgba(0,0,0,0.05);">
            <div class="card-body p-3 d-flex align-items-center justify-content-between">
                <div>
                    <div style="font-size: 1.4rem; font-weight: 600;">{{ stats.monthly_revenue|default:0|floatformat:0 }}</div>
                    <div style="font-size: 0.875rem; opacity: 0.9; font-weight: 500;">CA du mois</div>
                    <small style="font-size: 0.75rem; opacity: 0.7;">{{ stats.yearly_revenue|default:0|floatformat:0 }} FCFA/an</small>
                </div>
                <div class="text-center">
                    <i class="bi bi-currency-exchange" style="font-size: 1.5rem; opacity: 0.3;"></i>
                </div>
            </div>
        </div>
    </div>

    <div class="col-xl-3 col-lg-3 col-md-6 col-12">
        <div class="card" style="background: #111827; color: white; border: none; border-radius: 12px; height: 110px; box-shadow: 0px 1px 2px rgba(0,0,0,0.05);">
            <div class="card-body p-3 d-flex align-items-center justify-content-between">
                <div>
                    <div style="font-size: 1.5rem; font-weight: 600;">{{ stats.low_stock_products|default:0 }}</div>
                    <div style="font-size: 0.875rem; opacity: 0.9; font-weight: 500;">Stock faible</div>
                    <small style="font-size: 0.75rem; color: #ffd43b;">{{ stats.out_of_stock_products|default:0 }} ruptures</small>
                </div>
                <div class="text-center">
                    <i class="bi bi-exclamation-triangle" style="font-size: 1.5rem; opacity: 0.3;"></i>
                    <div class="mt-1"><a href="{% url 'products:product_list' %}?stock_status=low" class="text-white" style="font-size: 0.75rem; text-decoration: none; opacity: 0.9;">Voir</a></div>
                </div>
            </div>
        </div>
    </div>

    <div class="col-xl-3 col-lg-3 col-md-6 col-12">
        <div class="card" style="background: linear-gradient(135deg, #10B981 0%, #059669 100%); color: white; border: none; border-radius: 12px; height: 110px; box-shadow: 0px 1px 2px rgba(0,0,0,0.05);">
            <div class="card-body p-3 d-flex align-items-center justify-content-between">
                <div>
                    <div style="font-size: 1.5rem; font-weight: 600;">{{ stats.total_categories|default:0 }}</div>
                    <div style="font-size: 0.875rem; opacity: 0.9; font-weight: 500;">Catégories</div>
                    <small style="font-size: 0.75rem; opacity: 0.7;">{{ stats.active_categories|default:0 }} actives</small>
                </div>
                <div class="text-center">
                    <i class="bi bi-tags" style="font-size: 1.5rem; opacity: 0.3;"></i>
                    <div class="mt-1"><a href="{% url 'products:category_list' %}" class="text-white" style="font-size: 0.75rem; text-decoration: none; opacity: 0.9;">Voir</a></div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Actions rapides en grille compacte -->
<div class="card mb-4">
    <div class="card-header">
        <h3 class="mb-0 d-flex align-items-center">
            <i class="bi bi-lightning text-primary me-2"></i>
            Actions Rapides
        </h3>
    </div>
    <div class="card-body">
        <div class="row g-3">
            <div class="col-xl-3 col-lg-3 col-md-6 col-12">
                <a href="{% url 'orders:order_create' %}" class="btn w-100 d-flex flex-column align-items-center py-3" style="background: #2D6EEA; color: white; height: 80px; border-radius: 12px; border: none; box-shadow: 0px 1px 2px rgba(0,0,0,0.05); transition: all 150ms ease-out;">
                    <i class="bi bi-plus-circle mb-2" style="font-size: 1.25rem;"></i>
                    <span style="font-size: 0.8rem; font-weight: 500; line-height: 1.2;">Nouvelle<br>Commande</span>
                </a>
            </div>
            <div class="col-xl-3 col-lg-3 col-md-6 col-12">
                <a href="{% url 'customers:customer_create' %}" class="btn w-100 d-flex flex-column align-items-center py-3" style="background: #16A34A; color: white; height: 80px; border-radius: 12px; border: none; box-shadow: 0px 1px 2px rgba(0,0,0,0.05); transition: all 150ms ease-out;">
                    <i class="bi bi-person-plus mb-2" style="font-size: 1.25rem;"></i>
                    <span style="font-size: 0.8rem; font-weight: 500; line-height: 1.2;">Nouveau<br>Client</span>
                </a>
            </div>
            <div class="col-xl-3 col-lg-3 col-md-6 col-12">
                <a href="{% url 'products:product_create' %}" class="btn w-100 d-flex flex-column align-items-center py-3" style="background: #6366F1; color: white; height: 80px; border-radius: 12px; border: none; box-shadow: 0px 1px 2px rgba(0,0,0,0.05); transition: all 150ms ease-out;">
                    <i class="bi bi-box mb-2" style="font-size: 1.25rem;"></i>
                    <span style="font-size: 0.8rem; font-weight: 500; line-height: 1.2;">Nouveau<br>Produit</span>
                </a>
            </div>
            <div class="col-xl-3 col-lg-3 col-md-6 col-12">
                <a href="{% url 'invoices:invoice_create' %}" class="btn w-100 d-flex flex-column align-items-center py-3" style="background: #F97316; color: white; height: 80px; border-radius: 12px; border: none; box-shadow: 0px 1px 2px rgba(0,0,0,0.05); transition: all 150ms ease-out;">
                    <i class="bi bi-receipt mb-2" style="font-size: 1.25rem;"></i>
                    <span style="font-size: 0.8rem; font-weight: 500; line-height: 1.2;">Nouvelle<br>Facture</span>
                </a>
            </div>
            <div class="col-xl-3 col-lg-3 col-md-6 col-12">
                <a href="{% url 'payments:payment_create' %}" class="btn w-100 d-flex flex-column align-items-center py-3" style="background: #8B5CF6; color: white; height: 80px; border-radius: 12px; border: none; box-shadow: 0px 1px 2px rgba(0,0,0,0.05); transition: all 150ms ease-out;">
                    <i class="bi bi-credit-card mb-2" style="font-size: 1.25rem;"></i>
                    <span style="font-size: 0.8rem; font-weight: 500; line-height: 1.2;">Nouveau<br>Paiement</span>
                </a>
            </div>
        </div>
    </div>
</div>

<!-- Activités récentes -->
<div class="row">
    <div class="col-lg-6 mb-4">
        <div class="card">
            <div class="card-header">
                <h3 class="mb-0 d-flex align-items-center">
                    <i class="bi bi-clock-history text-primary me-2"></i>
                    Commandes Récentes
                </h3>
            </div>
            <div class="card-body">
                {% if recent_orders %}
                    <div class="table-responsive">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>N° Commande</th>
                                    <th>Client</th>
                                    <th>Montant</th>
                                    <th>Statut</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for order in recent_orders %}
                                    <tr>
                                        <td><a href="{% url 'orders:order_detail' order.pk %}" class="text-primary text-decoration-none">{{ order.order_number }}</a></td>
                                        <td>{{ order.customer.display_name }}</td>
                                        <td>{{ order.total_amount|floatformat:0 }} FCFA</td>
                                        <td><span class="badge badge-primary">{{ order.get_status_display }}</span></td>
                                    </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                {% else %}
                    <div class="text-center py-4">
                        <i class="bi bi-list-check text-muted" style="font-size: 3rem; opacity: 0.5;"></i>
                        <h6 class="mt-3">Aucune commande récente</h6>
                        <p class="text-muted mb-0">Les commandes apparaîtront ici</p>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>

    <div class="col-lg-6 mb-4">
        <div class="card">
            <div class="card-header">
                <h3 class="mb-0 d-flex align-items-center">
                    <i class="bi bi-exclamation-triangle text-warning me-2"></i>
                    Alertes
                </h3>
            </div>
            <div class="card-body">
                {% if alerts %}
                    {% for alert in alerts %}
                        <div class="d-flex align-items-start p-3 mb-3" style="background: var(--color-gray-50); border-radius: var(--border-radius-sm); border-left: 4px solid var(--color-gray-200);">
                            <i class="bi bi-{{ alert.icon }} text-{{ alert.type }} me-3" style="font-size: 1.2rem;"></i>
                            <div class="flex-1">
                                <h6 class="mb-1">{{ alert.title }}</h6>
                                <p class="mb-0 text-muted" style="font-size: 0.875rem;">{{ alert.message }}</p>
                            </div>
                        </div>
                    {% endfor %}
                {% else %}
                    <div class="text-center py-4">
                        <i class="bi bi-check-circle text-success" style="font-size: 3rem; opacity: 0.7;"></i>
                        <h6 class="mt-3">Tout va bien !</h6>
                        <p class="text-muted mb-0">Aucune alerte à signaler</p>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}
